{% extends 'blog/base.html' %}

{% block title %}{{ post.title }} - Django Blog{% endblock %}

{% block content %}
    <h1>{{ post.title }}</h1>
    <span>By {{ post.author.username }}</span>
    <span>{{ post.published_date|date:"F d, Y \a\t g:i A" }}</span>

    {% if post.tags.all %}
        <span>Tags:</span>
        {% for tag in post.tags.all %}
            <a href="{% url 'tagged-posts' tag.slug %}">{{ tag.name }}</a>
        {% endfor %}
    {% endif %}

    <div>{{ post.content|linebreaks }}</div>

    <!-- Show edit/delete buttons only to the author -->
     {% if user == post.author %}
        <a href="{% url 'post-update' post.pk %}">Edit Post</a>
        <a href="{% url 'post-delete' post.pk %}">Delete Post</a>
    {% endif %}

    <a href="{% url 'posts' %}">&larr; Back to All Posts</a>

    <h2>Comments ({{ comments.count }})</h2>

    {% if user.is_authenticated %}
        <h3>Leave a Comment</h3>
        <form method="POST" action="{% url 'comment-create' post.pk %}">
            {% csrf_token %}

            {% if comment_form.non_field_errors %}
                {{ comment_form.non_field_errors }}
            {% endif %}

            {{ comment_form.content }}
            {% if comment_form.content.errors %}
                {{ comment_form.content.errors.0 }}
            {% endif %}

            <button type="submit">Post Comment</button>
        </form>
    {% else %}
        <p>Please <a href="{% url 'login' %}?next={{ request.path }}">Login</a> to leave a comment</p>
    {% endif %}

    <!-- Display comments -->
     {% if comments %}
        {% for comment in comments %}
            <span>{{ comment.author.username }}</span>
            <span>{{ comment.created_at|date:"F d, Y\a\t g:i A" }}</span>
            {% if comment.created_at != comment.updated_at %}
                <span>(edited)</span>
            {% endif %}

            {{ comment.content|linebreaks }}

            {% if user == comment.author %}
                <a href="{% url 'comment-update' comment.pk %}">Edit</a>
                <a href="{% url 'comment-delete' comment.pk %}">Delete</a>
            {% endif %}
        {% endfor %}
    {% else %}
        <p>No comments yet. Be the first to comment!</p>
    {% endif %}
{% endblock %}